<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Age Calculator</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="node_modules/js-datepicker/dist/datepicker.min.css">
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <div class="container">
        <h1>Age Calculator</h1>
        <form>
            <label for="birthdate">Enter your birth date:</label>
            <div class="date-input">
                <input type="text" id="birthdate" placeholder="dd/mm/yyyy" autocomplete="off">
                <i class="material-icons">calendar_month</i>
            </div>

            <button type="button" id="calculate-age">Calculate Age</button>
        </form>
        <p id="age-result" class="age-result"></p>
    </div>

    <script type="module">
        import { DateTime } from '/node_modules/luxon/build/es6/luxon.js';
        import '/node_modules/js-datepicker/dist/datepicker.min.js'

        const ageResultElement = document.getElementById('age-result');
        const calculateAgeElement = document.getElementById('calculate-age')
        const birthdateInputElement = document.getElementById('birthdate')

        // Initialize datepicker
        const picker = datepicker('#birthdate', {
            formatter: (input, date, instance) => {
                const value = date.toLocaleDateString('en-GB');
                input.value = value; // => 'dd/mm/yyyy'
            },
            maxDate: new Date(new Date().setDate(new Date().getDate() - 1)),
            showAllDates: true,
            onSelect: (instance, date) => {
                if (date instanceof Date) {
                    ageResultElement.style.visibility = "hidden"
                }
            }
        });

        // Function to calculate exact age
        function calculateExactAge(birthdateString) {
            const birthdate = DateTime.fromFormat(birthdateString, 'dd/MM/yyyy');

            const now = DateTime.now();
            const diff = now.diff(birthdate, ['years', 'months', 'days']).toObject();

            const years = Math.floor(diff.years);
            const months = Math.floor(diff.months);
            const days = Math.floor(diff.days);

            let ageResult = ''
            if (years) {
                ageResult += `${years} year${years === 1 ? "" : "s"} `
            }
            if (months) {
                ageResult += `${months} month${months === 1 ? "" : "s"} `
            }
            if (days) {
                ageResult += `${days} day${days === 1 ? "" : "s"}`
            }

            return ageResult;
        }

        // Function to validate the date format
        function isValidDateFormat(dateString) {
            // Parse date with Luxon using the specified format
            const date = DateTime.fromFormat(dateString, 'dd/MM/yyyy');

            // Check if the date is valid
            return date.isValid;
        }

        calculateAgeElement.addEventListener('click', () => {
            const birthdateString = birthdateInputElement.value;

            let textContent = ''
            if (isValidDateFormat(birthdateString)) {
                const age = calculateExactAge(birthdateString);
                textContent = `You are ${age} old.`;
            } else {
                textContent = "Please select your birthdate.";
            }
            ageResultElement.textContent = textContent
            ageResultElement.style.visibility = 'visible';
        });
    </script>
</body>

</html>
